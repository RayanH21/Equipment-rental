<!doctype html>
<html lang="nl">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Mandje - Equipment Rental</title>
    <style>
        body { font-family: system-ui, Arial; margin: 24px; }
        header { display:flex; justify-content:space-between; align-items:center; }
        table { border-collapse: collapse; width: 100%; margin-top: 16px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align:left; }
        button { padding:10px 12px; cursor:pointer; margin-top:14px; }
        .muted { color:#666; font-size:12px; }
    </style>
</head>
<body>
<header>
    <div>
        <h2>Mandje</h2>
        <div class="muted">Overzicht van je reservatie</div>
    </div>
    <div>
        <a href="/">Catalogus</a>
    </div>
</header>

<div id="content"></div>

<script>
    async function loadCart() {
        const res = await fetch('/api/cart');
        if (res.status === 403) {
            document.getElementById('content').innerHTML =
                '<p>Je moet ingelogd zijn om je mandje te bekijken. <a href="/login">Login</a></p>';
            return;
        }

        const items = await res.json();

        if (!items.length) {
            document.getElementById('content').innerHTML =
                '<p>Je mandje is leeg. <a href="/">Ga naar catalogus</a></p>';
            return;
        }

        const rows = items.map(i => `
      <tr>
        <td>${i.productName}</td>
        <td>${i.quantity}</td>
        <td>${i.fromDate}</td>
        <td>${i.toDate}</td>
      </tr>
    `).join('');

        document.getElementById('content').innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Aantal</th>
            <th>Van</th>
            <th>Tot</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
      <button id="checkoutBtn">Bevestigen (checkout)</button>
      <div class="muted" id="status"></div>
    `;

        document.getElementById('checkoutBtn').addEventListener('click', async () => {
            const resp = await fetch('/api/cart/checkout', { method: 'POST' });
            if (resp.ok) {
                window.location.href = '/checkout';
            } else {
                document.getElementById('status').textContent = 'Checkout mislukt.';
            }
        });
    }

    loadCart();
</script>
</body>
</html>
